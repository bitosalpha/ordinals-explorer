{"ast":null,"code":"var _jsxFileName = \"C:\\\\ordinals-explorer\\\\brc20-market-demo\\\\src\\\\components\\\\BuyConfirmAlert.tsx\",\n  _s = $RefreshSig$();\nimport { marketApi } from \"../utils/marketApi\";\nimport { Col, Flex, message, Modal, Row, Skeleton, Statistic } from \"antd\";\nimport { Brc20Item } from \"./Brc20Item\";\nimport { useEffect, useState } from \"react\";\nimport { useUnisat } from \"../provider/UniSatProvider\";\nimport { handleError } from \"../utils/utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport function BuyConfirmAlert({\n  item,\n  close,\n  onComplete\n}) {\n  _s();\n  const {\n    address,\n    pubkey,\n    signPsbt\n  } = useUnisat();\n  const [messageApi] = message.useMessage();\n  const [isLoading, setIsLoading] = useState(false);\n  const [bidPrepare, setBidPrepare] = useState();\n  useEffect(() => {\n    if (!address || !pubkey || !item) return;\n    // create bid prepare\n    marketApi.createBidPrepare({\n      auctionId: item.auctionId,\n      bidPrice: item.price,\n      address,\n      pubkey\n    }).then(setBidPrepare).catch(handleError);\n  }, [address, item, pubkey]);\n  async function buy() {\n    try {\n      setIsLoading(true);\n\n      // create bid to get bidId/psbtBid\n      const {\n        bidId,\n        psbtBid\n      } = await marketApi.createBid({\n        auctionId: item.auctionId,\n        bidPrice: item.price,\n        address,\n        pubkey\n      });\n\n      // sign psbt\n      const signedPsbt = await signPsbt(psbtBid);\n\n      // confirm\n      await marketApi.confirmBid({\n        auctionId: item.auctionId,\n        bidId,\n        psbtBid: signedPsbt,\n        psbtBid2: '',\n        psbtSettle: ''\n      });\n      messageApi.success('Buy Success');\n      onComplete && onComplete();\n    } catch (e) {\n      handleError(e);\n    } finally {\n      setIsLoading(false);\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(Modal, {\n    open: !!item,\n    onCancel: close,\n    title: \"Confirm\",\n    confirmLoading: isLoading,\n    onOk: buy,\n    children: item && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(Row, {\n        align: 'middle',\n        gutter: [16, 24],\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          span: 24,\n          children: /*#__PURE__*/_jsxDEV(Flex, {\n            justify: 'center',\n            children: /*#__PURE__*/_jsxDEV(Brc20Item, {\n              tick: item.tick,\n              amount: item.amount\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 79,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(KeyValue, {\n          label: 'Unit Price:',\n          value: item.unitPrice,\n          suffix: `sats/${item.tick}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(KeyValue, {\n          label: 'Total Price:',\n          value: item.price,\n          suffix: `sats`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 21\n        }, this), !bidPrepare ? /*#__PURE__*/_jsxDEV(Skeleton, {\n          active: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 39\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(KeyValue, {\n            label: 'Network fee',\n            value: bidPrepare.feeRate * bidPrepare.txSize,\n            suffix: 'sats'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(KeyValue, {\n            label: 'Total',\n            value: bidPrepare.feeRate * bidPrepare.txSize + item.price,\n            suffix: 'sats',\n            valueColor: \"var(--main-color)\",\n            fontSize: 22\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 17\n      }, this)\n    }, void 0, false)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 12\n  }, this);\n}\n_s(BuyConfirmAlert, \"aIgER3Msda25xJqbk+3NPVQUyrs=\", false, function () {\n  return [useUnisat, message.useMessage];\n});\n_c = BuyConfirmAlert;\nfunction KeyValue({\n  label,\n  value,\n  suffix,\n  fontSize = 14,\n  valueColor\n}) {\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Col, {\n      span: 6,\n      style: {\n        textAlign: 'right'\n      },\n      children: label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Col, {\n      span: 18,\n      children: /*#__PURE__*/_jsxDEV(Statistic, {\n        valueStyle: {\n          fontSize,\n          color: valueColor\n        },\n        value: value,\n        suffix: suffix\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n}\n_c2 = KeyValue;\nvar _c, _c2;\n$RefreshReg$(_c, \"BuyConfirmAlert\");\n$RefreshReg$(_c2, \"KeyValue\");","map":{"version":3,"names":["marketApi","Col","Flex","message","Modal","Row","Skeleton","Statistic","Brc20Item","useEffect","useState","useUnisat","handleError","jsxDEV","_jsxDEV","Fragment","_Fragment","BuyConfirmAlert","item","close","onComplete","_s","address","pubkey","signPsbt","messageApi","useMessage","isLoading","setIsLoading","bidPrepare","setBidPrepare","createBidPrepare","auctionId","bidPrice","price","then","catch","buy","bidId","psbtBid","createBid","signedPsbt","confirmBid","psbtBid2","psbtSettle","success","e","open","onCancel","title","confirmLoading","onOk","children","align","gutter","span","justify","tick","amount","fileName","_jsxFileName","lineNumber","columnNumber","KeyValue","label","value","unitPrice","suffix","active","feeRate","txSize","valueColor","fontSize","_c","style","textAlign","valueStyle","color","_c2","$RefreshReg$"],"sources":["C:/ordinals-explorer/brc20-market-demo/src/components/BuyConfirmAlert.tsx"],"sourcesContent":["import {BRC20ListItem, CreateBidPrepareRes, marketApi} from \"../utils/marketApi\";\r\nimport {Col, Flex, message, Modal, Row, Skeleton, Statistic} from \"antd\";\r\nimport {Brc20Item} from \"./Brc20Item\";\r\nimport {useEffect, useState} from \"react\";\r\nimport {useUnisat} from \"../provider/UniSatProvider\";\r\nimport {handleError} from \"../utils/utils\";\r\n\r\n\r\nexport function BuyConfirmAlert({item, close, onComplete}: {\r\n    item: BRC20ListItem,\r\n    close: () => void,\r\n    onComplete?: () => void\r\n}) {\r\n    const {address, pubkey, signPsbt} = useUnisat();\r\n    const [messageApi] = message.useMessage();\r\n\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [bidPrepare, setBidPrepare] = useState<CreateBidPrepareRes | undefined>();\r\n\r\n    useEffect(() => {\r\n        if (!address || !pubkey || !item)\r\n            return;\r\n        // create bid prepare\r\n        marketApi.createBidPrepare({\r\n            auctionId: item.auctionId,\r\n            bidPrice: item.price,\r\n            address,\r\n            pubkey\r\n        }).then(setBidPrepare).catch(handleError)\r\n\r\n    }, [address, item, pubkey]);\r\n\r\n    async function buy() {\r\n        try {\r\n            setIsLoading(true)\r\n\r\n            // create bid to get bidId/psbtBid\r\n            const {bidId, psbtBid} = await marketApi.createBid({\r\n                auctionId: item.auctionId,\r\n                bidPrice: item.price,\r\n                address,\r\n                pubkey,\r\n            })\r\n\r\n            // sign psbt\r\n            const signedPsbt = await signPsbt(psbtBid)\r\n\r\n            // confirm\r\n            await marketApi.confirmBid({\r\n                auctionId: item.auctionId,\r\n                bidId,\r\n                psbtBid: signedPsbt,\r\n                psbtBid2: '',\r\n                psbtSettle: '',\r\n            })\r\n\r\n            messageApi.success('Buy Success');\r\n\r\n            onComplete && onComplete()\r\n        } catch (e) {\r\n            handleError(e)\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    return <Modal\r\n        open={!!item}\r\n        onCancel={close}\r\n        title={\"Confirm\"}\r\n        confirmLoading={isLoading}\r\n        onOk={buy}\r\n    >\r\n        {\r\n            item && <>\r\n                <Row align={'middle'} gutter={[16, 24]}>\r\n                    <Col span={24}>\r\n                        <Flex justify={'center'}>\r\n                            <Brc20Item tick={item.tick} amount={item.amount}/>\r\n                        </Flex>\r\n                    </Col>\r\n\r\n                    <KeyValue label={'Unit Price:'} value={item.unitPrice} suffix={`sats/${item.tick}`}/>\r\n                    <KeyValue label={'Total Price:'} value={item.price} suffix={`sats`}/>\r\n                    {\r\n                        !bidPrepare ? <Skeleton active/> : <>\r\n                            <KeyValue label={'Network fee'} value={bidPrepare.feeRate * bidPrepare.txSize} suffix={'sats'}/>\r\n                            <KeyValue label={'Total'} value={bidPrepare.feeRate * bidPrepare.txSize + item.price}\r\n                                      suffix={'sats'} valueColor={\"var(--main-color)\"}\r\n                                      fontSize={22}/>\r\n\r\n                        </>\r\n                    }\r\n                </Row>\r\n\r\n            </>\r\n\r\n        }\r\n\r\n    </Modal>\r\n}\r\n\r\nfunction KeyValue({label, value, suffix, fontSize = 14, valueColor}: {\r\n    label: string,\r\n    value: string | number,\r\n    suffix?: string,\r\n    fontSize?: number,\r\n    valueColor?: string\r\n}) {\r\n    return <>\r\n        <Col span={6} style={{textAlign: 'right'}}>\r\n            {label}\r\n        </Col>\r\n        <Col span={18}>\r\n            <Statistic\r\n                valueStyle={{fontSize, color: valueColor}}\r\n                value={value}\r\n                suffix={suffix}/>\r\n        </Col>\r\n    </>\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}